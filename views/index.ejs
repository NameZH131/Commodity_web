<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸»é¡µ</title>
    <link rel="stylesheet" href="stylesheets/swiper-bundle.min.css">
    <link rel="stylesheet" href="stylesheets/style.css">
    <link rel="stylesheet" href="stylesheets/footer.css">
    <link rel="stylesheet" href="icon/iconfont.css">
    <link rel="stylesheet" href="stylesheets/index-section.css">


</head>

<body>


    <header class="topper">
        <div class="container">
            <div class="left" style="margin: 0 -60px;">
                <a href="#" title="æ”¶è—èŠ±ç¤¼ç½‘" onclick="showBookmarkAlert(); return false;">æ”¶è—èŠ±ç¤¼ç½‘</a>
                <div id="bookmarkAlert">è¯·ä½¿ç”¨ Ctrl+D æˆ– Cmd+D æ·»åŠ ä¹¦ç­¾ï¼Œæˆ–è€…æ‰‹åŠ¨åœ¨æµè§ˆå™¨èœå•ä¸­æ·»åŠ ä¹¦ç­¾ã€‚</div>
                <a href="/flowerAdvisePage" title="èŠ±ç¤¼å“é‰´">èŠ±ç¤¼å“é‰´</a>
                <a href="" title="å…³æ³¨æˆ‘ä»¬" class="follow-us">å…³æ³¨æˆ‘ä»¬</a>
                <!-- æ·»åŠ äºŒç»´ç div -->
                <div class="qr-code" style="display: none;">
                    <span
                        style="justify-content: center;align-items: center;display: flex;font-size: 20px;font-family:å¾®è½¯é›…é»‘;">åŠ å…¥ç²‰ä¸å›¢å§ğŸŒ¹</span>
                    <img src="/images/index/å…³æ³¨æˆ‘ä»¬.png" alt="å…¬ä¼—å·äºŒç»´ç " />
                </div>
            </div>
            <div class="right">
                <% if (req.session.user) { %>
                    <a href="/userInformationSetting" title="ç”¨æˆ·ä¸»é¡µ" class="iconshaking iconfont icon-yonghu1">
                        Dear<%= req.session.user.username %>
                    </a>
                    <% } else { %>
                        <a href="#" title="ç™»å½•/æ³¨å†Œ" class="iconshaking iconfont icon-denglu">ç™»å½•/æ³¨å†Œ</a>
                        <% } %>
                            <a href="/myFavorite" title="æˆ‘çš„æ”¶è—" class="iconshaking iconfont icon-shoucang">æˆ‘çš„æ”¶è—</a>
                            <a href="#" title="æˆ‘çš„æµè§ˆå†å²" class="iconshaking iconfont icon-lishixiao">æˆ‘çš„æµè§ˆå†å²</a>
                            <a href="/car" title="è´­ç‰©è½¦" class="iconshaking iconfont icon-gouwuche">è´­ç‰©è½¦</a>
            </div>
        </div>
    </header>
    <nav class="headBar">
        <div class="headBarTop">
            <div class="logo" style="margin: 0 100px;">
                <a href="/index" title="èŠ±ç¤¼ç½‘"><img src="/images/index/logo.png" alt="èŠ±ç¤¼ç½‘" width="248" height="41"></a>
            </div>
            <div class="search">
                <form action="/search" method="get">
                    <input type="text" class="search_input" name="search_input" placeholder="è¯·è¾“å…¥å…³é”®è¯æœç´¢"
                        autocomplete="on">
                    <button type="submit" class="search_btn iconfont icon-sousuo"
                        onclick="if($('.search_input').val()=='')return false;">æœç´¢</button>
                </form>
            </div>
        </div>
        <div class="headBarDown" style="margin: 0 120px;">
            <div class="allGoodsNavigation"><a href="#" title="å…¨éƒ¨å•†å“åˆ†ç±»">å…¨éƒ¨å•†å“åˆ†ç±»</a></div>
            <!-- åœ¨è¿™é‡Œæ·»åŠ å¼¹å‡ºèœå•çš„HTMLç»“æ„ -->
            <div class="popover" id="popover">
                <div class="popover-content">
                    <h3>é²œèŠ±</h3>
                    <ul>
                        <li><a href="#">ç«ç‘°</a></li>
                        <li><a href="#">ç™¾åˆ</a></li>
                        <li><a href="#">åº·ä¹ƒé¦¨</a></li>
                        <!-- æ›´å¤šé²œèŠ±åˆ†ç±» -->
                    </ul>
                    <!-- ä¸ºå…¶ä»–å•†å“åˆ†ç±»é‡å¤ä¸Šè¿°ç»“æ„ -->
                </div>
            </div>
            <div class="navLinks">
                <ul>
                    <li><a href="/index" title="é¦–é¡µ">é¦–é¡µ</a></li>
                    <li><a href="#" title="é²œèŠ±">é²œèŠ±</a></li>
                    <li><a href="#" title="ç»¿æ¤">ç»¿æ¤</a></li>
                    <li><a href="#" title="èŠ±ç“¶">èŠ±ç“¶</a></li>
                    <li><a href="#" title="é²œæœ">é²œæœ</a></li>
                </ul>
            </div>
        </div>
    </nav>
    <!-- swiperè½®æ’­å›¾ -->
    <div class="swiper-container" style="margin-top: 0;">
        <div class="swiper-wrapper">
            <div class="swiper-slide"><img src="/images/index/slide1.jpeg" alt="å›¾ç‰‡"></div>
            <div class="swiper-slide"><img src="/images/index/slide2.jpeg" alt="å›¾ç‰‡"></div>
            <div class="swiper-slide"><img src="/images/index/slide3.jpeg" alt="å›¾ç‰‡"></div>
            <div class="swiper-slide"><a href="/indexSpringImage"><img src="images/index/slide4.jpg" alt="å›¾ç‰‡"></a></div>
        </div>
        <!-- å¦‚æœéœ€è¦åˆ†é¡µå™¨ -->
        <!-- <div class="swiper-pagination"></div> -->
        <!-- å¦‚æœéœ€è¦å¯¼èˆªæŒ‰é’® -->
        <!-- <div class="swiper-button-prev"></div> -->
    </div>


    <section class="main-content">
        <div class="container">
            <h2 class="section-title">çƒ­é—¨äº§å“</h2>
            <div class="featured-products">
                <div class="row">
                    <% req.session.goods.forEach(function(product) { %>
                        <div class="col-4">
                            <div class="product-tile">
                                <div class="product-image">
                                    <a href="/goodsDetail/<%= product.id %>"><img src="<%= product.image_path %>"
                                            alt="å•†å“å±•ç¤ºå›¾"></a>
                                    <div class="overlay">
                                        <!-- å•†å“å›¾ç‰‡ä¸Šçš„å åŠ å±‚ï¼Œå¯ä»¥æ”¾ç½®æŒ‰é’®ç­‰ -->
                                        <button class="btn-add" data-product-id="<%= product.id %>">æ”¶è—</button>
                                        <button class="btn-buy" data-product-id="<%= product.id %>">ç«‹å³è´­ä¹°</button>
                                    <% if (carGoods) { %>
                                        <% const productInCart=carGoods.find(good=> product.id === good.goods_id); %>
                                            <% const cartText=productInCart ? 'å·²åœ¨è´­ç‰©è½¦' : 'åŠ å…¥è´­ç‰©è½¦' ; %>
                                                <button class="btn-cart" data-product-id="<%= product.id %>" <%=productInCart ? 'disabled' : '' %>><%=
                                                        cartText %></button>
                                                <% } else { %>
                                                    <button class="btn-cart" data-product-id="<%= product.id %>">åŠ å…¥è´­ç‰©è½¦</button>
                                                    <% } %>

                                    </div>
                                </div>
                                <div class="product-info">
                                    <h5>
                                        <%= product.name %>
                                    </h5>
                                    <p>Â¥&nbsp;<%= product.price %> åŸä»·&nbsp;<%= product.original_price %>
                                    </p>
                                </div>
                            </div>
                        </div>
                        <% }); %>
                </div>
            </div>
    </section>



    <!-- é¡µè„š -->
    <footer class="footer">
        <div class="container">
            <div class="footer-top">
                <div class="footer-column">
                    <h3>å…³äºæˆ‘ä»¬</h3>
                    <p>èŠ±ç¤¼ç½‘è‡´åŠ›äºæä¾›ä¼˜è´¨çš„é²œèŠ±åŠç¤¼å“æœåŠ¡ã€‚</p>
                </div>
                <div class="footer-column">
                    <h3>è”ç³»æˆ‘ä»¬</h3>
                    <p>å®¢æœç”µè¯ï¼š400-xxx-xxxx</p>
                    <p>é‚®ç®±ï¼šservice@flower.com</p>
                </div>
                <div class="footer-column">
                    <h3>å¸®åŠ©ä¸­å¿ƒ</h3>
                    <p><a href="#">å¸¸è§é—®é¢˜</a></p>
                    <p><a href="#">é…é€è¯´æ˜</a></p>
                    <p><a href="/aboutUs">å…³äºæˆ‘ä»¬</a></p>
                </div>
            </div>
            <div class="footer-bottom">
                <p>ç‰ˆæƒæ‰€æœ‰ &copy; 2024 èŠ±ç¤¼ç½‘</p>
            </div>
        </div>
    </footer>





    <!-- ç™»å½•æ³¨å†Œæ¨¡æ€çª—å£ -->

    <div class="modal" id="loginModal" style="<%= showModal ? 'display: block;' : 'display: none;' %>">
        <div class="modal-content">
            <span class="close" id="closeModal">&times;</span>
            <div class="tab">
                <button class="tablinks active" onclick="openTab(event, 'Login')">ç™»å½•</button>
                <button class="tablinks" onclick="openTab(event, 'Register')">æ³¨å†Œ</button>
            </div>

            <!-- ç™»å½•è¡¨å• -->
            <div id="Login" class="tabcontent" style="display: block;">
                <h3>ç™»å½•</h3>
                <form action="/login" method="post">
                    <table>
                        <tr>
                            <td><label for="id" class="iconfont icon-zhanghu">è´¦å·:</label></td>
                            <td><input type="text" id="id" name="id" required></td>
                        </tr>
                        <tr>
                            <td><label for="password" class="iconfont icon-mima">å¯†ç :</label></td>
                            <td>
                                <div class="password-container">
                                    <input type="password" id="password" name="password" required>
                                    <i id="loginIcon" class="iconfont icon-yanjing-guan" style="font-size: 24px;"></i>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2" style="text-align: center;">
                                <button type="submit">ç™»å½•</button>
                            </td>
                        </tr>
                    </table>
                </form>
                <% if (message) { %>
                    <div class="error-message">
                        <%= message %>
                    </div>
                    <% } %>
            </div>

            <!-- æ³¨å†Œè¡¨å• -->
            <div id="Register" class="tabcontent">
                <h3>æ³¨å†Œ</h3>
                <form action="/register" method="post">
                    <table>
                        <tr>
                            <td><label for="newId" class="iconfont icon-zhanghu">è´¦å·:</label></td>
                            <td><input type="text" id="newId" name="newId" required></td>
                        </tr>
                        <tr>
                            <td><label for="newPassword" class="iconfont icon-mima">å¯†ç :</label></td>
                            <td>
                                <div class="password-container">
                                    <input type="password" id="newPassword" name="newPassword" required>
                                    <i id="registerIcon" class="iconfont icon-yanjing-guan"
                                        style="font-size: 24px;"></i>
                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2" style="text-align: center;">
                                <button type="submit">æ³¨å†Œ</button>
                            </td>
                        </tr>
                    </table>
                </form>
                <% if (message) { %>
                    <div class="error-message">
                        <%= message %>
                    </div>
                    <% } %>
            </div>
        </div>
    </div>






    <script src="/javascripts/swiper-bundle.min.js"></script>

    <script>
        // åˆå§‹åŒ–swiper
        var mySwiper = new Swiper('.swiper-container', {
            direction: 'horizontal',
            loop: true,
            pagination: {
                el: '.swiper-pagination',
                clickable: true,
                dynamicBullets: true,
            },

            autoplay: {
                delay: 3000,
                disableOnInteraction: false,
            }
        });
    </script>


    <% if (showWelcome==true) { %>
        <!-- æ¨±èŠ± -->
        <script src="/javascripts/sakura.js"></script>
        <% } %>
            <!-- å¼•å…¥è‡ªå®šä¹‰çš„JavaScriptæ–‡ä»¶ -->
            <script src="javascripts/index/index.js"></script>


            <script>
                document.querySelectorAll('.btn-cart').forEach(button => {
                    button.addEventListener('click', function () {
                        const productId = this.getAttribute('data-product-id');
                        console.log('Adding product with ID:', productId);
                        const productAddToCar = {
                            productId: parseInt(productId),
                            quantity: 1 // é»˜è®¤æ•°é‡ä¸º 1ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼è·å–
                        };


                        // æ˜¾ç¤ºåŠ è½½æç¤º
                        const loading = document.getElementById('loading');
                        loading.style.display = 'block';
                        setTimeout(() => {
                            loading.style.display = 'none';
                        }, 15000);

                        // å‘é€è¯·æ±‚åˆ°åç«¯
                        fetch('/addToCar', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(productAddToCar)
                        })
                            .then(response => {
                                if (!response.ok) {
                                    throw new Error(`Network response was not ok (${response.status}${response.statusText})`);
                                }
                                return response.json();
                            })
                            .then(data => {
                                console.log(data);
                                // è¿™é‡Œæ›´æ–°è´­ç‰©è½¦å›¾æ ‡æˆ–æ˜¾ç¤ºé€šçŸ¥
                                // éšè—åŠ è½½æç¤º
                                // loading.style.display = 'none';
                                window.location.reload();
                            })
                            .catch(error => {
                                console.error('Error:', error);
                                alert('æ·»åŠ åˆ°è´­ç‰©è½¦å¤±è´¥ï¼Œè¯·ç¨åå†è¯•ã€‚');
                                // loading.style.display = 'none';
                                window.location.reload();

                            });
                    });
                });

            </script>
            <!-- EJSå¯¼å…¥åŠ è½½htmlæ ‡ç­¾ -->
            <%- include('loading.ejs') %>



                <script>
                    // å½“é¡µé¢è¢«æ‰“å¼€æ—¶ï¼Œæ£€æŸ¥æ ‡è®°
                    window.addEventListener('load', function () {
                        if (sessionStorage.getItem("needsRefresh") === "true") {
                            // åˆ·æ–°é¡µé¢

                            // const loading = document.getElementById('loading');
                            // loading.style.display = 'block';
                            // setTimeout(() => {
                            //     loading.style.display = 'none';

                            // }, 300);
                            // sleep(100);

                 
                            location.reload();
                            // é‡ç½®æ ‡è®°
                            sessionStorage.setItem("needsRefresh", "false");
                        }
                    });

                    // å½“é¡µé¢å‡†å¤‡å¸è½½æ—¶ï¼Œè®¾ç½®æ ‡è®°
                    window.addEventListener('beforeunload', function () {
                        sessionStorage.setItem("needsRefresh", "true");
                    });

                </script>
</body>

</html>